{
  "Comment": "HourStats Bluesky Bot Workflow",
  "StartAt": "Start",
  "States": {
    "Start": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-orchestrator",
      "Parameters": {
        "action": "startWorkflow"
      },
      "ResultPath": "$.OrchestratorOutput",
      "Next": "FetchBatch1"
    },
    "FetchBatch1": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-fetcher",
      "Parameters": {
        "runId.$": "$.runId",
        "analysisIntervalMinutes": 30,
        "batchId": "batch-0"
      },
      "ResultPath": "$.FetcherOutput1",
      "Next": "FetchBatch2"
    },
    "FetchBatch2": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-fetcher",
      "Parameters": {
        "runId.$": "$.runId",
        "analysisIntervalMinutes": 30,
        "batchId": "batch-1"
      },
      "ResultPath": "$.FetcherOutput2",
      "Next": "FetchBatch3"
    },
    "FetchBatch3": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-fetcher",
      "Parameters": {
        "runId.$": "$.runId",
        "analysisIntervalMinutes": 30,
        "batchId": "batch-2"
      },
      "ResultPath": "$.FetcherOutput3",
      "Next": "FetchBatch4"
    },
    "FetchBatch4": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-fetcher",
      "Parameters": {
        "runId.$": "$.runId",
        "analysisIntervalMinutes": 30,
        "batchId": "batch-3"
      },
      "ResultPath": "$.FetcherOutput4",
      "Next": "FetchBatch5"
    },
    "FetchBatch5": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-fetcher",
      "Parameters": {
        "runId.$": "$.runId",
        "analysisIntervalMinutes": 30,
        "batchId": "batch-4"
      },
      "ResultPath": "$.FetcherOutput5",
      "Next": "CheckCompletion"
    },
    "CheckCompletion": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-orchestrator",
      "Parameters": {
        "action": "checkCompletion",
        "runId.$": "$.OrchestratorOutput.runId"
      },
      "ResultPath": "$.CompletionOutput",
      "Next": "AnalyzePosts"
    },
    "AnalyzePosts": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-analyzer",
      "Parameters": {
        "runId.$": "$.OrchestratorOutput.runId"
      },
      "ResultPath": "$.AnalyzerOutput",
      "Next": "AggregateResults"
    },
    "AggregateResults": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-aggregator",
      "Parameters": {
        "runId.$": "$.OrchestratorOutput.runId"
      },
      "ResultPath": "$.AggregatorOutput",
      "Next": "PostSummary"
    },
    "PostSummary": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:${aws_region}:${aws_account_id}:function:hourstats-poster",
      "Parameters": {
        "runId.$": "$.OrchestratorOutput.runId"
      },
      "End": true
    }
  }
}